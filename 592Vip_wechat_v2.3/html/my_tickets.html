<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/my_tickets.css"/>
		<link rel="stylesheet" type="text/css" href="../css/font-awesome-4.7.0/css/font-awesome.css"/>
		<style>
			
		</style>
	</head>
	<body>
		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll">
						<a class="mui-control-item mui-active" href="#item1mobile">
							可用(100)
						</a>
						<a class="mui-control-item" href="#item2mobile">
							未激活
						</a>
						<a class="mui-control-item" href="#item3mobile">
							已使用
						</a>
						<a class="mui-control-item" href="#item4mobile">
							已过期
						</a>
						
					</div>
				</div>
				<div class="mui-slider-group">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view tickets_item">
									
								</ul>
							</div>
						</div>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view tickets_item">
									<li class="mui-table-view-cell tickets_i">
										<div class="tickets_f">
											<div class="tickets_left"><span><small>￥</small>1</span>满500可用</div>
											<div class="tickets_cont">
												<div class="tickets_title">
													<span class="">店铺券</span>小神通乐园0
												</div>
												<div class="tickets_time">有效期2017-06-25至2017-06-25</div>
											</div>
										</div>
										<div class="tickets_line">&nbsp;</div>
										<div class="tickets_msg">本券仅供店铺使用</div>
										<div class="ticket_used">
											<img src="../image/unactive.png"/>
										</div>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<div id="item3mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view tickets_item">
									<li class="mui-table-view-cell tickets_i">
										<div class="tickets_f">
											<div class="tickets_left"><span><small>￥</small>1</span>满500可用</div>
											<div class="tickets_cont">
												<div class="tickets_title">
													<span class="">店铺券</span>活动商家通用
												</div>
												<div class="tickets_time">有效期2017-06-25至2017-06-25</div>
											</div>
										</div>
										<div class="tickets_line">&nbsp;</div>
										<div class="tickets_msg">本券仅供店铺使用</div>
										<div class="ticket_passed">
											<img src="../image/ticket_used@3x.png"/>
										</div>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<div id="item4mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view tickets_item">
									<li class="mui-table-view-cell tickets_i">
										<div class="tickets_f">
											<div class="tickets_left"><span><small>￥</small>1</span>满500可用</div>
											<div class="tickets_cont">
												<div class="tickets_title">
													<span class="">店铺券</span>小神通乐园0
												</div>
												<div class="tickets_time">有效期2017-06-25至2017-06-25</div>
											</div>
										</div>
										<div class="tickets_line">&nbsp;</div>
										<div class="tickets_msg">本券仅供店铺使用</div>
										<div class="ticket_passed">
											<img src="../image/ticket_pass@3x.png"/>
										</div>
									</li>
								</ul>
							</div>
						</div>
					</div>
					
				</div>
			</div>
		</div>
		
		<div id="popover" class="mui-popover">
			<div class="ticket_s">
				<div class="ticket_code" id="qrcode">
					<!--<img src="../image/ticket_code.png" />-->
				</div>
			    <div class="ticket_s_title">
			    	<span class="ticket_blue">体验券</span>色调会员体验卡
			    </div>
			    <div class="ticket_s_code">
			    	券码：586541254545
			    </div>
			    <div class="ticket_s_msg">
					<i class="fa fa-exclamation-circle" style="margin-right: 3px;"></i>本券仅限色调美发体验使用			    	
			    </div>
			    <div class="ticket_s_confirm">
			    	<span>确认使用</span>
			    </div>
			</div>
			<div class="tickets_close">
				<i class="mui-icon mui-icon-close"></i>
			</div>
		</div>
		
	</body>

</html>
<script src="../js/mui.min.js"></script>
<script src="../js/mui.pullToRefresh.js"></script>
<script src="../js/mui.pullToRefresh.material.js"></script>
<script src="../js/qrcode.js" type="text/javascript" charset="utf-8"></script>
<script>
	mui.init();
	(function($) {
		//阻尼系数
		var deceleration = mui.os.ios?0.003:0.0009;
		$('.mui-scroll-wrapper').scroll({
			bounce: false,
			indicators: true, //是否显示滚动条
			deceleration:deceleration
		});
		$.ready(function() {
			//循环初始化所有下拉刷新，上拉加载。
			$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
				$(pullRefreshEl).pullToRefresh({
//					down: {
//						auto:true,
//						callback: function() {
//							var self = this;
//							setTimeout(function() {
//								var ul = self.element.querySelector('.mui-table-view');
//								ul.insertBefore(createFragment(ul, index, 10, true), ul.firstChild);
//								self.endPullDownToRefresh(true);
//							}, 1000);
//						}
//					},
					up: {
						auto:true,
						callback: function() {
							var self = this;
							setTimeout(function() {
								var ul = self.element.querySelector('.mui-table-view');
								ul.appendChild(createFragment(ul, index, 5));
								self.endPullUpToRefresh(true);
							}, 1000);
						}
					}
				});
			});
			var createFragment = function(ul, index, count, reverse) {
				var length = ul.querySelectorAll('li').length;
				var fragment = document.createDocumentFragment();
				var li;
				for (var i = 0; i < count; i++) {
					var spanc='';
					if(i%5==1){
						spanc='ticket_org'
					}else if(i%5==2){
						spanc='ticket_blue'
					}else if(i%5==3){
						spanc='ticket_green'
					}else if(i%5==4){
						spanc='ticket_purple'
					}
					li = document.createElement('li');
					li.className = 'mui-table-view-cell tickets_i';
					li.innerHTML = '<div class="tickets_f">'
						    	+		'<div class="tickets_left">'
						    	+			'<span><small>￥</small>1</span>活动商家通用'
						    	+		'</div>'
						    	+		'<div class="tickets_cont">'
						    	+			'<div class="tickets_title">'
						    	+				'<span class="'+spanc+'">店铺券</span>小神通乐园'+(length+i)
						    	+			'</div>'
						    	+			'<div class="tickets_time">'
						    	+				'有效期2017-06-25至2017-06-25'
						    	+			'</div>'
						    	+		'</div>'
						    	+	'</div>'
						    	+	'<div class="tickets_line">'
						    	+		'&nbsp;'
						    	+	'</div>'
						    	+	'<div class="tickets_msg">'
						    	+		'本券仅供店铺使用'
						    	+	'</div>';
					fragment.appendChild(li);
				}
				return fragment;
			};
		});
	})(mui);
	ticketsClick()
	mui(".tickets_close").on('tap','i',function(){
	  mui("#popover").popover('hide')
	}) 
	var qrcode = new QRCode(document.getElementById("qrcode"), {
	    width : 100,
	    height : 100
	});
	
	function ticketsClick(){
		mui('#slider').on('tap','.tickets_i',function(){
			mui("#popover").popover('show');
			qrcode.makeCode('111');
		})
	}
	
</script>
