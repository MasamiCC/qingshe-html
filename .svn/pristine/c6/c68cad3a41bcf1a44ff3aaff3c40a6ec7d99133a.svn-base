<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/yh.css"/>
		<style type="text/css">
			.mui-input-group{
				background: none!important;
			}
			.mui-input-group:after,.mui-input-group:before{
				height: 0;
			}			
			.mui-btn-block{
				padding: 8px 0;
			}
			.mui-input-row{
				border-radius: 5px ;color: #b6ddee;margin: 5px 0 5px 0;
			}
			.mui-input-group .mui-input-row:after{
				height: 0;
			}
			input[type=color], input[type=date], input[type=datetime-local], input[type=datetime], input[type=email], input[type=month], input[type=number], input[type=password], input[type=search], input[type=tel], input[type=text], input[type=time], input[type=url], input[type=week], select, textarea{
				margin-bottom: 6px;
			}
			.yh_t{
				position: relative;
			}
			.share{
				position: absolute;top: 0;left: 0;width: 100%;height: 100%;
			    background-size: 100% 100%;
			    text-align: center;line-height: 90px;color: #fff;z-index: 99!important;font-size: 20px;
			}
			li.li_share:before{
				content: '';
			    display: block;
			    width: 100%;
			    height: 100%;
			    position: absolute;
			    top: 0;
			    right: 0;
			    bottom: 0;
			    left: 0;
			    background: url(image/share_bg.png);
			    background-repeat: no-repeat;
			    background-position: center;
			    background-size: 100% 100%;
			    opacity: 0.5;
			    color: #fff;
			    font-size: 25px;text-align: center;
			    vertical-align: middle;
			    line-height: 90px;
			    z-index: 98!important;
			}
		</style>
	</head>

	<body>
		<div class="mui-content">
		    <div class="yh yh_first">
		    	<div class="yh_first_con">
		    		<div class="yh_first_content" id="step1">
		    			<div>
		    				<ul>
		    					<li class="yh_t">
		    						<div class="yh_t_item yh_t_l">
		    							<span id="" class="yh_count">
		    								30
		    							</span>元
		    							<p>现金券</p>
		    						</div>
		    						<div class="yh_t_item yh_t_r">
		    							<p>仅限十八里香龙虾馆使用</p>
		    							<p>现金优惠，无金额限制，消费即享</p>
		    							<p>限领取日期30日之内使用，过期取消</p>
		    						</div>
		    					</li>
		    					<li class="yh_t li_share">
		    						<div class="yh_t_item yh_t_l">
		    							<span id="" class="yh_count">
		    								30
		    							</span>元
		    							<p>现金券</p>
		    						</div>
		    						<div class="yh_t_item yh_t_r">
		    							<p>仅限十八里香龙虾馆使用</p>
		    							<p>现金优惠，无金额限制，消费即享</p>
		    							<p>限领取日期30日之内使用，过期取消</p>
		    						</div>
		    						<div class="share">
		    							分享可领
		    						</div>
		    					</li>
		    				</ul>
		    			</div>
		    			<div class="mui-input-row" id="mobile_div">
	    			        <input type="tel" class="mui-input-clear" placeholder="请输入手机号码" maxlength="11" id="mobile">
	    			    </div>
	    			    <button type="button" class="mui-btn mui-btn-blue mui-btn-block" id="step1_btn">立即领取</button>
	    			    <div id="un_registed">
	    			    	<div class="mui-input-row" style="position: relative;">
		    			        <input type="text" id="code" class="mui-input-clear" placeholder="请输入验证码">
		    			        <span class="send_code"  id="send_code">发送验证码</span>
		    			    </div>
		    			    <button type="button" class="mui-btn mui-btn-blue mui-btn-block" id="step2_btn">绑定并领取</button>
	    			    </div>
	    			    <div id="registed">
	    			    	<p style="text-align: center;">优惠券已放入账户 <span style="color: #ff3f3f;">13827357489</span> <br />请登录APP即可使用</p>
			    			<div id="receive_success">
			    				<button type="button" class="mui-btn mui-btn-blue mui-btn-block">立即使用</button>
			    				<button type="button" class="mui-btn mui-btn-danger mui-btn-block">分享活动</button>
			    			</div>
	    			    </div>
		    		</div>
		    	</div>
		    </div>
		    <div class="yh yh_banner">
		    	<img src="image/yh_banner.png"/>
		    </div>
		    <div class="yh yh_padding">
		    	<div class="yh_title">
		    		<span></span>大家都到 
		    		<!--<a href="yh_list.html" class="mui-pull-right my_yh">我的领取记录</a>-->
		    	</div>
		    	<div class="" style="overflow: hidden;height: 345px;">
		    		<ul class="mui-table-view" id="yh_list">
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">137****4567</span>
		    		                	<span class="yh_time">2017-06-19 12:00</span>
		    		                	<p class="yh_name">长坂町</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">9.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">188****4785</span>
		    		                	<span class="yh_time">2017-06-19 12:01</span>
		    		                	<p class="yh_name">爱江山婚庆圆</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">5.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">177****3645</span>
		    		                	<span class="yh_time">2017-06-19 12:02</span>
		    		                	<p class="yh_name">长坂町</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">12.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">188****9770</span>
		    		                	<span class="yh_time">2017-06-19 13:00</span>
		    		                	<p class="yh_name">爱江山婚庆圆</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">20.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">132****0931</span>
		    		                	<span class="yh_time">2017-06-19 13:05</span>
		    		                	<p class="yh_name">长坂町</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">75.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">139****8828</span>
		    		                	<span class="yh_time">2017-06-19 13:40</span>
		    		                	<p class="yh_name">爱江山婚庆圆</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">14.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">156****3895</span>
		    		                	<span class="yh_time">2017-06-19 13:40</span>
		    		                	<p class="yh_name">长坂町</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">23.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">159****5672</span>
		    		                	<span class="yh_time">2017-06-19 13:43</span>
		    		                	<p class="yh_name">爱江山婚庆圆</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">35.00</span>
		    		               	</div>
		    		        </li>
		    		        <li class="mui-table-view-cell yh_item" >
		    		                <div class="yh_item_l">
		    		                	<span class="yh_mobile">137****4937</span>
		    		                	<span class="yh_time">2017-06-19 15:00</span>
		    		                	<p class="yh_name">长坂町</p>
		    		                </div>
		    		               	<div class="yh_item_r">
		    		               		<span class="mui-pull-right yh_amount">50.00</span>
		    		               	</div>
		    		        </li>
		    		    </ul>
		    	</div>
		    </div>
		    <div class="yh yh_padding">
		    	<div class="yh_title">
		    		<span></span>活动规则
		    	</div>
		    	<div class="yh_rule">
		    		<p>1.每个用户每天最多可以领取两次；</p>
		    		<p>2.领取的优惠必须在对应的商户才可以使用，并且仅限当前的领取手机号；</p>
		    		<p>3.发放至手机号的优惠需要在APP用手机号注册，或者在微信服务号绑定手机号后可使用；</p>
		    		<p>4.优惠仅限在线支付的时候抵用，每个订单仅可使用一次优惠；</p>
		    		<p>5.轻奢点评保留法律范围内允许的活动最终解释权。</p>
		    	</div>
		    </div>
		</div>
		
	</body>

</html>
<script src="js/mui.min.js"></script>
<script src="js/jquery-1.10.1.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	mui.init()
	$(function(){
		/**/
		
		timer=setInterval(function(){
			loadHistoryList();
		},1000)
		var width=$(window).width();
		console.log(width)
		$(".yh_first").css({
			height:parseInt(width*1010/750)
		})
		$("#step1_btn").on('tap',function(){
			var mobile=$("#mobile").val();
			if (!(/^1(3|4|5|7|8)\d{9}$/.test(mobile))) {
				mui.alert('请输入正确的手机号码');
				return false;
			}else{
				//领取优惠券 ajax 处理函数
				//flg 0 未注册 1 已注册
				var flg=1
				receiveResponse(flg,mobile)
			}
		})
		
	})
	var timer='';
	var shangjia=['禅心素食馆','2046酒吧','长坂町','爱江山婚庆圆','濠河时光','二百六西餐厅','红角龙虾','花椒餐厅','桃花岛','前田日料'];
	var mobile=[159,158,177,133,131,188,187];
	var mobile2=parseInt(Math.random()*8999+1000) ;
	console.log(mobile2)
	function loadHistoryList(){
		var now=new Date();
		var time=now.getFullYear()+"-"+now.getMonth()+'-'+now.getDate()+" "+now.getHours()+":"+now.getMinutes()
		var html='<li class="mui-table-view-cell yh_item" >'
		    		        +        '<div class="yh_item_l">'
		    		        +        	'<span class="yh_mobile">'+mobile[parseInt(Math.random()*6)]+'****'+parseInt(Math.random()*8999+1000)+'</span>'
		    		        +        	'<span class="yh_time">'+time+'</span>'
		    		        +        	'<p class="yh_name">'+shangjia[parseInt(Math.random()*10)] +'</p>'
		    		        +        '</div>'
		    		        +       	'<div class="yh_item_r">'
		    		        +       		'<span class="mui-pull-right yh_amount">'+parseInt(Math.random()*100).toFixed(2)+'</span>'
		    		        +       	'</div>'
		    		        +'</li>'
		var size=$(".yh_item").size();
		if (size<=5) {
			$("#yh_list").append(html);
		}else{
			$("#yh_list li").eq(0).slideUp(function(){
				$("#yh_list").append(html);
				$("#yh_list li").eq(0).remove()
			})
		}
	}
	function receiveResponse(flg,mobile){
		$("#step1_btn").hide();
		//flg 0 未注册 1 已注册
		if (flg==0) {
			$("#un_registed").fadeIn(function(){
				sendCode(mobile);
			})
			
		} else{
			recevieSuccess(mobile);
			$("#registed").fadeIn()
		}
	}
	function recevieSuccess(mobile){
		$("#registed span").text(mobile);
		$("#un_registed").hide();
		$("#mobile_div").hide();
		$("#registed").show();
		
	}
	
	var timer='';
	function sendCode(mobile){
		$("#send_code").on('tap',function(){
			//ajax请求发送短信，成功之后调用倒计时函数
			timeChange()
		})
		//绑定并领取按钮事件添加
		$("#step2_btn").on('tap',function(){
			var code=$("#code").val();
			if (code=='') {
				mui.alert('请输入验证码！');
				return false;
			}
			//点击绑定并领取按钮调用事件
			registerReceive(mobile,code)
		})
	}
	function registerReceive(mobile,code){
		//ajax处理绑定领取，返回成功之后调用
		recevieSuccess(mobile)
	}
	function timeChange(){
		clearInterval(timer);
		var time=60;
		timer=setInterval(function(){
			if (time>0) {
				$(".send_code").html(time+"s后重试");
				time--;
			} else{
				$(".send_code").html("发送验证码");
				clearInterval(timer);
			}
		},1000)
	}
</script>