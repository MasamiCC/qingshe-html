<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>轻奢点评个人中心</title>
		<link href="../css/layout1.css" rel="stylesheet"/>
		<link rel="stylesheet" href="../css/Vcommon.css" />
		<style type="text/css">
			.form_input{
				height: 30px;line-height: 30px;border: 1px solid #ccc;text-indent: 10px;
				min-width: 300px;border-radius: 5px;
			}
			.search_btn{
				padding: 7px 15px;border-radius: 5px;
			}
			.tb_left{
			    width: 120px;
			    color: #333;
			    /*background: #D4AC57;*/
			    text-indent: 10px;
			    text-align: right;
			    padding-right: 10px;
			}
			.attr_li input[type=text]{
				border:0;color: #aaa;
			}
			.txt_btn{
				margin:25px auto;
			}
		</style>
	</head>
	<body>
		<div class="main">
			<div class="cont" id="index_cont">
				<div class="content" id="main1">
					<div id="t1">
						<div id="pic1">
							<img id="p1" src="../img/slogo.png" />
						</div>
					</div>
					<div id="t2">
						<div id="column1" class="columns">
						<p class="tc th"><span><img src="../img/suser.png"/>&nbsp;&nbsp;</span>个人中心</p>
						<p class="tc tb tb2"><a href="Vbasic.html">基本信息</a></p>
						<p class="tc tb tb2"><a href="Vzizhanghu.html">子账号管理</a></p>
						<!--<p class="tc tb tb2"><a href="contract.html">我的合同</a></p>-->
						</div>
						<div id="column2" class="columns">
						<p class="tc th"><span><img src="../img/shop.png"/>&nbsp;&nbsp;</span>商品管理</p>
						<p class="tc tb tb2"><a href="Vgoods.html">全部商品</a></p>
						<p class="tc tb tb2"><a href="Vadd_goods.html">新增商品</a></p>
						<p class="tc tb tb2"><a href="Vgoods_cat.html">分类管理</a></p>
						</div>
						<div id="column3" class="columns">
						<p class="tc th"><span><img src="../img/order.png"/>&nbsp;&nbsp;</span>订单管理</p>
							<p class="tc tb tb2"><a href="Vorder.html">全部订单</a></p>
						<!--<p class="tc tb tb2">临时订单</p>
						<p class="tc tb tb2">在线点单</p>-->
						<!--<p class="tc tb tb2"><a href="order_in.html">订单收款</a></p>-->
						<p class="tc tb tb2"><a href="Vorder_check.html">验证订单</a></p>
						</div>
						<div id="column4" class="columns">
						<p class="tc th"><span><img src="../img/editor.png"/>&nbsp;&nbsp;</span>评价管理</p>
						<p class="tc tb tb2"><a href="Vpingjia.html">订单评价</a></p>
						</div>
						<!--<div id="column5" class="columns">
						<p class="tc th">财务管理</p>
						<p class="tc tb tb2"><a href="liushui.html">流水统计</a></p>
						<p class="tc tb tb2"><a href="tixian.html">提现记录</a></p>
						</div>-->
						<!--<div id="column6" class="columns">
						<p class="tc th">活动管理</p>
						<p class="tc tb tb2">优惠券管理</p>
						<p class="tc tb tb2">推广管理</p>
						</div>
						<div id="column7" class="columns">
						<p class="tc th">商户社区</p>
						<p class="tc tb tb2">圈子管理</p>
						</div>
						<div id="column8" class="columns">
						<p class="tc th">帮助中心</p>
						</div>-->
					</div>
				</div>
				<!--个人中心正文中间部分-->	
				<div class="content" id="main2">
					<div id="txt">
				<!--正文部分开始-->
					<!--头部-->
						<div id="header">
							<div id="head">
								<div id="cl" class="head heade1">
									<ul>
										<li class="business"><i>商家中心</i> 
											<i class="shopname">当前商家：江南厨房</i>
										</li>
										<!--<li><span>个人中心</span>><span>子账号管理</span></li>-->
									</ul>
								</div>
								<div id="cr" class="head head_r">
									<div class="head heade2">
										<img src="../img/qvip.png"/>
									</div>
									<div class="head line"> 
										<ul>
											<li>下午好！13059891234</li>
											<li>欢迎进入轻奢点评商家中心</li>
										</ul>
									</div>
									<div class="head heade3">
										<a href="" class="login_out"><img src="../img/esc.png"/></a>
									</div>
								</div>
							</div>
						</div>
					<!--头部-->
						<!--正文-->
						<div class="titleMes" style="font-weight: 600;margin:30px 0px 10px 20px"><i>个人中心</i>><i>商品规格</i></div>
						
						<div class="txt_list guige">
							<table border="0" cellspacing="0" cellpadding="0" width="100%" id="created_table">
								<tr>
									<td class="tb_left">规格一</td>
									<td>
										<ul>
											<!--<li class="attr_li">1#属性一 <span ></span></li>
											<li class="attr_li">1#属性二<span ></span></li>
											<li class="attr_li">1#属性三<span ></span></li>-->
											<li class="attr_li">
												<input type="text" name="" id="" value="新增属性" placeholder="新增属性" class="new_attr" />
											</li>
										</ul>
									</td>
								</tr>
								<tr>
									<td class="tb_left">规格二</td>
									<td>
										<ul>
											<!--<li class="attr_li">2#属性一<span ></span></li>
											<li class="attr_li">2#属性二<span ></span></li>
											<li class="attr_li">2#属性三<span ></span></li>
											<li class="attr_li">2#属性四<span ></span></li>
											<li class="attr_li">2#属性五<span ></span></li>
											<li class="attr_li">2#属性六<span ></span></li>
											<li class="attr_li">2#属性气<span ></span></li>-->
											<li class="attr_li">
												<input type="text" name="" id="" value="新增属性" placeholder="新增属性" class="new_attr"/>
											</li>
										</ul>
									</td>
								</tr>
							</table>
							<div class="msg_title">
								规格参数
							</div>
							<table border="0" cellspacing="0" cellpadding="0" width="100%" id="attr_table">
								<tr>
									<th>规格一</th><th>规格二</th><th>价格</th><th>选中</th>
								</tr>
								
							</table>
							<div style="text-align: center; margin-top: 20px;">
								<span id="" class="txt_btn">
										提交并保存
									</span>
							</div>
						</div>
						
						<!--正文部分结束-->
					
				</div>
			</div>
	     </div>
	     <div id="footer">
				COPYRIGHT 2016-2017 592VIP. all rights reserved.
			</div>
	</body>
	<script type="text/javascript" src="../js/jquery-1.8.3.min.js"></script>
	
</html>
<script type="text/javascript">
	$(function(){
		$(".new_attr").each(function(){
			$(this).bind({
				"focus":function(){
					var value=$(this).val();
					if(value=='新增属性'){
						$(this).val('')
						$(this).attr({
							placeholder:''
						})
					}
				},
				"blur":function(){
					var value=$(this).val();
					rememberData()
					if(value==''){
						$(this).val('新增属性')
						$(this).attr({
							placeholder:'新增属性'
						})
					}else{
						var li=$(this).parent();
						var count=0;
						li.siblings().each(function(){
							if (value==$(this).text()) {
								count++;
							}
						})
						if (count>0) {
							alert('您输入的标签已经存在！')
						}else{
							li.before('<li class="attr_li">'+value+'<span ></span></li>');
							
							creatTable();
							bindClick()
						}
						$(this).val('新增属性')
						$(this).attr({
							placeholder:'新增属性'
						})
					}
				}
			})
		})
		
	})
	function  bindClick(){
		$(".attr_li span").each(function(){
			$(this).bind({
				'click':function(){
					var del=confirm('确定删除该规格属性')
					if(del){
						$(this).parent().remove();
						creatTable();
					}
				}
			})
		})
	}
//	var data=new Array();
	function loadData(){
		var data=new Array();
		$('#created_table tr').each(function(){
			var temp=new Array();
			temp['name']=$(this).find('.tb_left').text()
			temp['content']='';
			if ($(this).find('.attr_li').length>1) {
				temp['content']=new Array();
				$(this).find('.attr_li').each(function(e){
					var key=$(this).text();
					if (key.trim().length>0) {
						temp['content'].push(key.trim());
					}
				})
			}
			if(temp['content']!=''){
				data.push(temp)	
			}
			
		})
		//console.log(data instanceof Array)
		return data;
	}
	function creatTable(){
		
		var data=loadData();
		//console.log(data)
		var length=Object.keys(data).length;
		
		var table=$('<table border="0" cellspacing="0" cellpadding="0" width="100%" id="attr_table"></table>')
		var thead=$("<tr></tr>");
		var tbody=$('<tbody></tbody>');
		var first=data.shift();
		if (first) {
			var second='';
			thead.html(thead.html()+"<th>"+first['name']+"</th>");
			if (Object.keys(data).length>0) {
				second=data.shift();
				thead.html(thead.html()+"<th>"+second['name']+"</th>");
				for (var i in first['content']) {
					for (var j in second['content']) {
						var tr=$("<tr></tr>");
						tr.attr({
							'id':i+"#"+j,
						})
						if (j==0) {
							tr.append('<td rowspan="'+second['content'].length+'" class="list_left" >'+first['content'][i]+'</td>');
						}
						tr.append('<td class="list_left">'+second['content'][j]+'</td>');
						if (attr_data_key.indexOf(i+"#"+j)>=0) {
							var checked=(attr_data[i+"#"+j]['checked'])?'checked':'';
							tr.append('<td class="list_left"><input type="text" value="'+attr_data[i+"#"+j]['price']+'" placeholder="price"></td>');
							tr.append('<td class="list_center "><input type="checkbox" value="" placeholder="price"'+checked+'></td>');
						}else{
							tr.append('<td class="list_left"><input type="text" value="" placeholder="price"></td>');
							tr.append('<td class="list_center "><input type="checkbox" value="" placeholder="price" ></td>');
						}
	//					tr.append('<td><input type="text" value="" placeholder="price"></td>');
	//					tr.append('<td><input type="checkbox" value="" placeholder="price"></td>');
						tbody.append(tr);
					}
					
				}
			}else{
				for (var i in first['content']) {
					var tr=$("<tr></tr>");
					tr.attr({
						'id':i,
					})
					tr.append('<td class="list_left">'+first['content'][i]+'</td>');
					if (attr_data_key.indexOf(i)>=0) {
						var checked=(attr_data[i]['checked'])?'checked':'';
						tr.append('<td class="list_left "><input type="text" value="'+attr_data[i]['price']+'" placeholder="price"></td>');
						tr.append('<td class="list_center "><input type="checkbox" value="" placeholder="price"'+checked+'></td>');
					}else{
						tr.append('<td class="list_left "><input type="text" value="" placeholder="price"></td>');
						tr.append('<td class="list_center "><input type="checkbox" value="" placeholder="price" ></td>');
					}
					tbody.append(tr);
				}
			}
			thead.html(thead.html()+'<th>价格</th><th>选中</th>')
		}
		
		
		table.append(thead).append(tbody);
		
		$("#attr_table").replaceWith(table)
	}
	var attr_data=new Array();
	var attr_data_key=new Array();
	function rememberData(){
		//var attr_data=new Array();
		attr_data_key.splice(0,attr_data_key.length)
		attr_data.splice(0,attr_data.length)
		$("#attr_table tr").each(function(e){
			var id=$(this).attr('id');
			if(id){
				attr_data_key.push(id);
				var temp=[];
				temp['price']=$(this).find('input[type=text]').eq(0).val();
				temp['checked']=$(this).find('input[type=checkbox]').eq(0).prop('checked');
				attr_data[id]=temp;
			}
		})
		console.log(attr_data)
	}
</script>


